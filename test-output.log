[0;36m
==========================================
  Messaging Operator Functional Tests
==========================================
[0m
[0;34m[INFO][0m Options:
[0;34m[INFO][0m   Fresh cluster: true
[0;34m[INFO][0m   Skip deploy:   false
[0;34m[INFO][0m   Skip tests:    false
[0;34m[INFO][0m   Bats only:     false
[0;34m[INFO][0m   Java only:     false
[0;34m[INFO][0m   Test filter:   <none>
[0;34m[INFO][0m   Cleanup:       true
[0;36m
==========================================
  Setting up Minikube Cluster
==========================================
[0m

==========================================
  Minikube Cluster Setup
==========================================

[0;34m[INFO][0m Deleting existing cluster 'messaging-operator-test'...
* Deleting "messaging-operator-test" in docker ...
* Deleting container "messaging-operator-test" ...
* Removing /home/florent/.minikube/machines/messaging-operator-test ...
* Removed all traces of the "messaging-operator-test" cluster.
[0;32m[OK][0m Cluster deleted
[0;34m[INFO][0m Creating new Minikube cluster 'messaging-operator-test'...
[0;34m[INFO][0m   Driver: docker
[0;34m[INFO][0m   CPUs: 2
[0;34m[INFO][0m   Memory: 4096MB
* [messaging-operator-test] minikube v1.37.0 on Ubuntu 24.04
* Using the docker driver based on user configuration
* Using Docker driver with root privileges
* Starting "messaging-operator-test" primary control-plane node in "messaging-operator-test" cluster
* Pulling base image v0.0.48 ...
* Configuring bridge CNI (Container Networking Interface) ...
* Verifying Kubernetes components...
  - Using image gcr.io/k8s-minikube/storage-provisioner:v5
* Enabled addons: default-storageclass, storage-provisioner

! /usr/bin/kubectl is version 1.29.15, which may have incompatibilities with Kubernetes 1.34.0.
  - Want kubectl v1.34.0? Try 'minikube kubectl -- get pods -A'
* Done! kubectl is now configured to use "messaging-operator-test" cluster and "default" namespace by default
[0;32m[OK][0m Cluster created and ready
[0;34m[INFO][0m Setting kubectl context to cluster 'messaging-operator-test'...
Switched to context "messaging-operator-test".
[0;32m[OK][0m Context set
[0;34m[INFO][0m Creating namespace 'test-1768463280'...
namespace/test-1768463280 created
[0;32m[OK][0m Namespace 'test-1768463280' created
[0;32m[OK][0m Namespace written to /home/florent/conduktor_quick_start_in_a_single_container/functional-tests/scripts/../.test-namespace
[0;34m[INFO][0m Verifying cluster health...
node/messaging-operator-test condition met
coredns-66bc5c9577-q8gq5                          1/1   Running   0     44s
etcd-messaging-operator-test                      1/1   Running   0     48s
kube-apiserver-messaging-operator-test            1/1   Running   0     48s
kube-controller-manager-messaging-operator-test   1/1   Running   0     48s
kube-proxy-6z89v                                  1/1   Running   0     44s
[0;32m[OK][0m Cluster is healthy

==========================================
  Cluster Information
==========================================

  Cluster Name: messaging-operator-test
  Namespace:    test-1768463280
  Context:      messaging-operator-test

  Minikube IP:  192.168.58.2

  To use this cluster:
    export KUBECONFIG=$(minikube -p messaging-operator-test kubeconfig)
    kubectl config use-context messaging-operator-test

[0;32m[OK][0m Setup complete!
[0;36m
==========================================
  Deploying Messaging Operator
==========================================
[0m

==========================================
  Messaging Operator Deployment
==========================================

[0;34m[INFO][0m Using namespace: test-1768463280
[0;34m[INFO][0m Building Java application...
[0;32m[OK][0m Java build complete
[0;34m[INFO][0m Configuring Docker to use Minikube daemon...
[0;34m[INFO][0m Building Docker image: messaging-operator:latest...
[0;34m[INFO][0m Creating Dockerfile for webhook...
#0 building with "default" instance using docker driver

#1 [internal] load build definition from Dockerfile.webhook
#1 DONE 0.0s

#1 [internal] load build definition from Dockerfile.webhook
#1 transferring dockerfile: 283B done
#1 DONE 0.1s

#2 [internal] load metadata for docker.io/library/eclipse-temurin:21-jre-alpine
#2 DONE 1.7s

#3 [internal] load .dockerignore
#3 transferring context: 2B done
#3 DONE 0.0s

#4 [1/3] FROM docker.io/library/eclipse-temurin:21-jre-alpine@sha256:326837fba06a8ff5482a17bafbd65319e64a6e997febb7c85ebe7e3f73c12b11
#4 resolve docker.io/library/eclipse-temurin:21-jre-alpine@sha256:326837fba06a8ff5482a17bafbd65319e64a6e997febb7c85ebe7e3f73c12b11
#4 resolve docker.io/library/eclipse-temurin:21-jre-alpine@sha256:326837fba06a8ff5482a17bafbd65319e64a6e997febb7c85ebe7e3f73c12b11 0.1s done
#4 sha256:93902f35c01693819c190c354786cbb573f4ef49a5b865d6c34f2197839cc3e4 0B / 16.29MB 0.1s
#4 sha256:3a857bcc1a1505748a54fef25bb81f303468a26d3de127b6b0044b1ffde6275a 0B / 53.17MB 0.1s
#4 sha256:326837fba06a8ff5482a17bafbd65319e64a6e997febb7c85ebe7e3f73c12b11 2.68kB / 2.68kB done
#4 sha256:d52fed95b86b9374fcd6f289f022b7d5ef4de6fdbe1e49a59cf7551496027090 1.94kB / 1.94kB done
#4 sha256:cb895430823c34591ae6fe71fede85189d0d344383acac20889ac0b5276a9caa 4.09kB / 4.09kB done
#4 sha256:2d35ebdb57d9971fea0cac1582aa78935adf8058b2cc32db163c98822e5dfa1b 0B / 3.80MB 0.1s
#4 sha256:2d35ebdb57d9971fea0cac1582aa78935adf8058b2cc32db163c98822e5dfa1b 1.05MB / 3.80MB 0.5s
#4 sha256:93902f35c01693819c190c354786cbb573f4ef49a5b865d6c34f2197839cc3e4 3.15MB / 16.29MB 0.6s
#4 sha256:2d35ebdb57d9971fea0cac1582aa78935adf8058b2cc32db163c98822e5dfa1b 2.10MB / 3.80MB 0.6s
#4 sha256:93902f35c01693819c190c354786cbb573f4ef49a5b865d6c34f2197839cc3e4 8.39MB / 16.29MB 0.7s
#4 sha256:2d35ebdb57d9971fea0cac1582aa78935adf8058b2cc32db163c98822e5dfa1b 3.80MB / 3.80MB 0.7s done
#4 sha256:93902f35c01693819c190c354786cbb573f4ef49a5b865d6c34f2197839cc3e4 13.63MB / 16.29MB 0.8s
#4 sha256:3a857bcc1a1505748a54fef25bb81f303468a26d3de127b6b0044b1ffde6275a 6.29MB / 53.17MB 0.8s
#4 extracting sha256:2d35ebdb57d9971fea0cac1582aa78935adf8058b2cc32db163c98822e5dfa1b 0.1s
#4 sha256:15a75c308165465141d861c1b7f7ec799b18fc84d5d8b87396dc29c3aa4894ff 0B / 128B 0.8s
#4 sha256:93902f35c01693819c190c354786cbb573f4ef49a5b865d6c34f2197839cc3e4 16.29MB / 16.29MB 0.9s
#4 sha256:3a857bcc1a1505748a54fef25bb81f303468a26d3de127b6b0044b1ffde6275a 10.84MB / 53.17MB 0.9s
#4 sha256:93902f35c01693819c190c354786cbb573f4ef49a5b865d6c34f2197839cc3e4 16.29MB / 16.29MB 0.9s done
#4 sha256:3a857bcc1a1505748a54fef25bb81f303468a26d3de127b6b0044b1ffde6275a 15.73MB / 53.17MB 1.0s
#4 sha256:23d1cf1d02f064d13d647e4816e26b17678a634769ec583b4eb29d5a68d415f7 0B / 2.28kB 1.0s
#4 sha256:3a857bcc1a1505748a54fef25bb81f303468a26d3de127b6b0044b1ffde6275a 19.92MB / 53.17MB 1.1s
#4 sha256:15a75c308165465141d861c1b7f7ec799b18fc84d5d8b87396dc29c3aa4894ff 128B / 128B 1.0s done
#4 sha256:3a857bcc1a1505748a54fef25bb81f303468a26d3de127b6b0044b1ffde6275a 25.17MB / 53.17MB 1.2s
#4 extracting sha256:2d35ebdb57d9971fea0cac1582aa78935adf8058b2cc32db163c98822e5dfa1b 0.5s done
#4 sha256:3a857bcc1a1505748a54fef25bb81f303468a26d3de127b6b0044b1ffde6275a 32.51MB / 53.17MB 1.3s
#4 sha256:23d1cf1d02f064d13d647e4816e26b17678a634769ec583b4eb29d5a68d415f7 2.28kB / 2.28kB 1.2s done
#4 extracting sha256:93902f35c01693819c190c354786cbb573f4ef49a5b865d6c34f2197839cc3e4
#4 sha256:3a857bcc1a1505748a54fef25bb81f303468a26d3de127b6b0044b1ffde6275a 38.80MB / 53.17MB 1.4s
#4 sha256:3a857bcc1a1505748a54fef25bb81f303468a26d3de127b6b0044b1ffde6275a 45.09MB / 53.17MB 1.5s
#4 sha256:3a857bcc1a1505748a54fef25bb81f303468a26d3de127b6b0044b1ffde6275a 50.33MB / 53.17MB 1.6s
#4 sha256:3a857bcc1a1505748a54fef25bb81f303468a26d3de127b6b0044b1ffde6275a 53.17MB / 53.17MB 1.7s
#4 ...

#5 [internal] load build context
#5 transferring context: 68.20MB 1.8s done
#5 DONE 1.9s

#4 [1/3] FROM docker.io/library/eclipse-temurin:21-jre-alpine@sha256:326837fba06a8ff5482a17bafbd65319e64a6e997febb7c85ebe7e3f73c12b11
#4 sha256:3a857bcc1a1505748a54fef25bb81f303468a26d3de127b6b0044b1ffde6275a 53.17MB / 53.17MB 1.7s done
#4 extracting sha256:93902f35c01693819c190c354786cbb573f4ef49a5b865d6c34f2197839cc3e4 1.1s done
#4 extracting sha256:3a857bcc1a1505748a54fef25bb81f303468a26d3de127b6b0044b1ffde6275a
#4 extracting sha256:3a857bcc1a1505748a54fef25bb81f303468a26d3de127b6b0044b1ffde6275a 3.1s done
#4 extracting sha256:15a75c308165465141d861c1b7f7ec799b18fc84d5d8b87396dc29c3aa4894ff done
#4 extracting sha256:23d1cf1d02f064d13d647e4816e26b17678a634769ec583b4eb29d5a68d415f7
#4 extracting sha256:23d1cf1d02f064d13d647e4816e26b17678a634769ec583b4eb29d5a68d415f7 done
#4 DONE 6.5s

#6 [2/3] WORKDIR /app
#6 DONE 0.4s

#7 [3/3] COPY target/*.jar app.jar
#7 DONE 0.3s

#8 exporting to image
#8 exporting layers
#8 exporting layers 0.3s done
#8 writing image sha256:b910d31068183984bcd019fde231078991fd32fb7ae292e788e5acd29755a0f5
#8 writing image sha256:b910d31068183984bcd019fde231078991fd32fb7ae292e788e5acd29755a0f5 done
#8 naming to docker.io/library/messaging-operator:latest 0.0s done
#8 DONE 0.3s

 [33m1 warning found (use docker --debug to expand):
[0m - SecretsUsedInArgOrEnv: Do not use ARG or ENV instructions for sensitive data (ENV "TLS_KEY_PATH") (line 7)
[0;32m[OK][0m Docker image built: messaging-operator:latest
[0;34m[INFO][0m Generating TLS certificates...

==========================================
  TLS Certificate Generator
==========================================

[0;34m[INFO][0m Using namespace: test-1768463280
[0;34m[INFO][0m Service name: messaging-operator-webhook
[0;34m[INFO][0m Creating certificate directory: /home/florent/conduktor_quick_start_in_a_single_container/functional-tests/scripts/../.certs
[0;34m[INFO][0m Generating CA private key...
[0;34m[INFO][0m Generating CA certificate...
[0;32m[OK][0m CA certificate generated
[0;34m[INFO][0m Generating server private key...
[0;34m[INFO][0m Creating certificate signing request...
[0;34m[INFO][0m Signing server certificate with CA...
Certificate request self-signature ok
subject=CN = messaging-operator-webhook.test-1768463280.svc, O = messaging-operator
[0;32m[OK][0m Server certificate generated with SANs:
  - messaging-operator-webhook
  - messaging-operator-webhook.test-1768463280
  - messaging-operator-webhook.test-1768463280.svc
  - messaging-operator-webhook.test-1768463280.svc.cluster.local
[0;34m[INFO][0m Exporting base64-encoded certificates...
[0;32m[OK][0m TLS values written to values-tls.yaml

==========================================
  Certificate Information
==========================================

  CA Certificate:
    subject=CN = Messaging Operator CA, O = messaging-operator
    notBefore=Jan 15 07:50:13 2026 GMT
    notAfter=Jan 15 07:50:13 2027 GMT

  Server Certificate:
    subject=CN = messaging-operator-webhook.test-1768463280.svc, O = messaging-operator
    notBefore=Jan 15 07:50:13 2026 GMT
    notAfter=Jan 15 07:50:13 2027 GMT

  Files created:
    total 36
    drwxrwxr-x 2 florent florent 4096 Jan 15 08:50 .
    drwxrwxr-x 7 florent florent 4096 Jan 15 08:50 ..
    -rw-rw-r-- 1 florent florent 1224 Jan 15 08:50 ca.crt
    -rw------- 1 florent florent 1704 Jan 15 08:50 ca.key
    -rw-rw-r-- 1 florent florent   41 Jan 15 08:50 ca.srl
    -rw-rw-r-- 1 florent florent  567 Jan 15 08:50 server.conf
    -rw-rw-r-- 1 florent florent 1566 Jan 15 08:50 server.crt
    -rw-rw-r-- 1 florent florent 1338 Jan 15 08:50 server.csr
    -rw------- 1 florent florent 1704 Jan 15 08:50 server.key

[0;32m[OK][0m Certificate generation complete!
[0;32m[OK][0m Certificates generated
[0;34m[INFO][0m Deploying with Helm...
Warning: resource namespaces/test-1768463280 is missing the kubectl.kubernetes.io/last-applied-configuration annotation which is required by kubectl apply. kubectl apply should only be used on resources created declaratively by either kubectl create --save-config or kubectl apply. The missing annotation will be patched automatically.
namespace/test-1768463280 configured
Release "messaging-operator" does not exist. Installing it now.
NAME: messaging-operator
LAST DEPLOYED: Thu Jan 15 08:50:14 2026
NAMESPACE: test-1768463280
STATUS: deployed
REVISION: 1
TEST SUITE: None
[0;32m[OK][0m Helm deployment complete
[0;34m[INFO][0m Waiting for webhook deployment to be ready...
deployment.apps/messaging-operator-webhook condition met
[0;32m[OK][0m Webhook deployment is ready
[0;34m[INFO][0m Verifying deployment...
[0;34m[INFO][0m Checking CRDs...
[0;32m[OK][0m All 6 CRDs installed
[0;34m[INFO][0m Checking ValidatingWebhookConfiguration...
validatingwebhookconfiguration.admissionregistration.k8s.io/messaging-operator-webhook
[0;32m[OK][0m Deployment verification complete

==========================================
  Deployment Information
==========================================

  Release:    messaging-operator
  Namespace:  test-1768463280
  Image:      messaging-operator:latest

  Pods:
    messaging-operator-webhook-788c6f5c6d-blshc   1/1   Running   0     18s

  Services:
    messaging-operator-webhook   ClusterIP   10.111.210.172   <none>   443/TCP   18s

[0;32m[OK][0m Deployment complete!
[0;36m
==========================================
  Running Bats Tests
==========================================
[0m
[0;34m[INFO][0m Running Bats test files:
  - 01_deployment.bats
  - 02_webhook_admission.bats
  - 03_ownership_chain.bats
  - 04_multi_tenant.bats
  - 05_ha_failover.bats
1..47
# Setting up deployment tests
not ok 1 webhook deployment exists in 263ms
# (in test file functional-tests/bats/01_deployment.bats, line 16)
#   `assert_success' failed
#
# -- command failed --
# status : 1
# output : Error from server (NotFound): deployments.apps "messaging-operator-messaging-operator-webhook" not found
# --
#
ok 2 webhook deployment has ready replicas in 167ms
not ok 3 webhook service exists in 271ms
# (in test file functional-tests/bats/01_deployment.bats, line 28)
#   `assert_success' failed
#
# -- command failed --
# status : 1
# output : Error from server (NotFound): services "messaging-operator-messaging-operator-webhook" not found
# --
#
not ok 4 webhook service has endpoints in 293ms
# (in test file functional-tests/bats/01_deployment.bats, line 34)
#   `assert_success' failed
#
# -- command failed --
# status : 1
# output (2 lines):
#   Warning: v1 Endpoints is deprecated in v1.33+; use discovery.k8s.io/v1 EndpointSlice
#   Error from server (NotFound): endpoints "messaging-operator-messaging-operator-webhook" not found
# --
#
ok 5 webhook pod is running in 251ms
ok 6 ApplicationService CRD is installed in 260ms
ok 7 VirtualCluster CRD is installed in 331ms
ok 8 ServiceAccount CRD is installed in 425ms
ok 9 Topic CRD is installed in 263ms
ok 10 ACL CRD is installed in 232ms
ok 11 ConsumerGroup CRD is installed in 139ms
ok 12 all 6 CRDs are installed in 265ms
not ok 13 ValidatingWebhookConfiguration exists in 276ms
# (in test file functional-tests/bats/01_deployment.bats, line 86)
#   `assert_success' failed
#
# -- command failed --
# status : 1
# output : Error from server (NotFound): validatingwebhookconfigurations.admissionregistration.k8s.io "messaging-operator-messaging-operator-webhook" not found
# --
#
not ok 14 ValidatingWebhookConfiguration has 5 webhooks in 337ms
# (in test file functional-tests/bats/01_deployment.bats, line 94)
#   `[[ "$webhook_count" -eq 5 ]]' failed
# Error from server (NotFound): validatingwebhookconfigurations.admissionregistration.k8s.io "messaging-operator-messaging-operator-webhook" not found
# Setting up webhook admission tests
ok 15 webhook accepts valid ApplicationService in 4097ms
ok 16 webhook accepts valid VirtualCluster with existing ApplicationService in 6318ms
ok 17 webhook accepts valid ServiceAccount with prerequisites in 5407ms
ok 18 webhook accepts valid Topic with prerequisites in 6086ms
ok 19 webhook accepts valid ACL with prerequisites in 5836ms
ok 20 webhook accepts valid ConsumerGroup with prerequisites in 5963ms
ok 21 webhook rejects ApplicationService with missing name in 4131ms
not ok 22 webhook rejects VirtualCluster with non-existent ApplicationService ref in 3977ms
# (in test file functional-tests/bats/02_webhook_admission.bats, line 121)
#   `assert_failure' failed
# Cleaning up test resources in namespace: test-1768463280
# No resources found
# No resources found
# No resources found
# No resources found
# No resources found
# No resources found
#
# -- command succeeded, but it was expected to fail --
# output : virtualcluster.messaging.example.com/invalid-vc created
# --
#
not ok 23 webhook rejects ServiceAccount with non-existent VirtualCluster ref in 4561ms
# (in test file functional-tests/bats/02_webhook_admission.bats, line 141)
#   `assert_failure' failed
# Cleaning up test resources in namespace: test-1768463280
# No resources found
# No resources found
# No resources found
# No resources found
# virtualcluster.messaging.example.com "invalid-vc" deleted
# No resources found
# applicationservice.messaging.example.com/test-app created
#
# -- command succeeded, but it was expected to fail --
# output : serviceaccount.messaging.example.com/invalid-sa created
# --
#
not ok 24 webhook rejects Topic with non-existent ServiceAccount ref in 4996ms
# (in test file functional-tests/bats/02_webhook_admission.bats, line 162)
#   `assert_failure' failed
# Cleaning up test resources in namespace: test-1768463280
# No resources found
# No resources found
# No resources found
# serviceaccount.messaging.example.com "invalid-sa" deleted
# No resources found
# applicationservice.messaging.example.com "test-app" deleted
# applicationservice.messaging.example.com/test-app created
# virtualcluster.messaging.example.com/test-vc created
#
# -- command succeeded, but it was expected to fail --
# output : topic.messaging.example.com/invalid-topic created
# --
#
# Setting up ownership chain tests
ok 25 full ownership chain - valid hierarchy accepted in 6673ms
not ok 26 VirtualCluster requires valid ApplicationService reference in 4136ms
# (in test file functional-tests/bats/03_ownership_chain.bats, line 62)
#   `assert_failure' failed
# Cleaning up test resources in namespace: test-1768463280
# topic.messaging.example.com "chain-topic" deleted
# No resources found
# No resources found
# serviceaccount.messaging.example.com "chain-sa" deleted
# virtualcluster.messaging.example.com "chain-vc" deleted
# applicationservice.messaging.example.com "chain-app" deleted
#
# -- command succeeded, but it was expected to fail --
# output : virtualcluster.messaging.example.com/orphan-vc created
# --
#
not ok 27 ServiceAccount requires valid VirtualCluster reference in 4098ms
# (in test file functional-tests/bats/03_ownership_chain.bats, line 83)
#   `assert_failure' failed
# Cleaning up test resources in namespace: test-1768463280
# No resources found
# No resources found
# No resources found
# No resources found
# virtualcluster.messaging.example.com "orphan-vc" deleted
# No resources found
# applicationservice.messaging.example.com/test-app created
#
# -- command succeeded, but it was expected to fail --
# output : serviceaccount.messaging.example.com/orphan-sa created
# --
#
not ok 28 Topic requires valid ServiceAccount reference in 5388ms
# (in test file functional-tests/bats/03_ownership_chain.bats, line 105)
#   `assert_failure' failed
# Cleaning up test resources in namespace: test-1768463280
# No resources found
# No resources found
# No resources found
# serviceaccount.messaging.example.com "orphan-sa" deleted
# No resources found
# applicationservice.messaging.example.com "test-app" deleted
# applicationservice.messaging.example.com/test-app created
# virtualcluster.messaging.example.com/test-vc created
#
# -- command succeeded, but it was expected to fail --
# output : topic.messaging.example.com/orphan-topic created
# --
#
not ok 29 ACL requires valid ServiceAccount reference in 4860ms
# (in test file functional-tests/bats/03_ownership_chain.bats, line 127)
#   `assert_failure' failed
# Cleaning up test resources in namespace: test-1768463280
# topic.messaging.example.com "orphan-topic" deleted
# No resources found
# No resources found
# No resources found
# virtualcluster.messaging.example.com "test-vc" deleted
# applicationservice.messaging.example.com "test-app" deleted
# applicationservice.messaging.example.com/test-app created
# virtualcluster.messaging.example.com/test-vc created
#
# -- command succeeded, but it was expected to fail --
# output : acl.messaging.example.com/orphan-acl created
# --
#
not ok 30 ConsumerGroup requires valid ServiceAccount reference in 4524ms
# (in test file functional-tests/bats/03_ownership_chain.bats, line 148)
#   `assert_failure' failed
# Cleaning up test resources in namespace: test-1768463280
# No resources found
# acl.messaging.example.com "orphan-acl" deleted
# No resources found
# No resources found
# virtualcluster.messaging.example.com "test-vc" deleted
# applicationservice.messaging.example.com "test-app" deleted
# applicationservice.messaging.example.com/test-app created
# virtualcluster.messaging.example.com/test-vc created
#
# -- command succeeded, but it was expected to fail --
# output : consumergroup.messaging.example.com/orphan-cg created
# --
#
not ok 31 ServiceAccount must belong to same ApplicationService as VirtualCluster in 4443ms
# (in test file functional-tests/bats/03_ownership_chain.bats, line 173)
#   `assert_failure' failed
# Cleaning up test resources in namespace: test-1768463280
# No resources found
# No resources found
# consumergroup.messaging.example.com "orphan-cg" deleted
# No resources found
# virtualcluster.messaging.example.com "test-vc" deleted
# applicationservice.messaging.example.com "test-app" deleted
# applicationservice.messaging.example.com/app-a created
# applicationservice.messaging.example.com/app-b created
# virtualcluster.messaging.example.com/vc-a created
#
# -- command succeeded, but it was expected to fail --
# output : serviceaccount.messaging.example.com/cross-sa created
# --
#
ok 32 resources can be deleted in reverse dependency order in 5711ms
# Setting up multi-tenant tests
ok 33 tenant A can create resources under own ApplicationService in 543ms
ok 34 tenant B can create resources under own ApplicationService in 460ms
not ok 35 tenant B cannot reference tenant A VirtualCluster in 363ms
# (in test file functional-tests/bats/04_multi_tenant.bats, line 59)
#   `assert_failure' failed
#
# -- command succeeded, but it was expected to fail --
# output : serviceaccount.messaging.example.com/cross-tenant-sa created
# --
#
not ok 36 tenant B cannot reference tenant A ServiceAccount in 167ms
# (in test file functional-tests/bats/04_multi_tenant.bats, line 77)
#   `assert_failure' failed
#
# -- command succeeded, but it was expected to fail --
# output : topic.messaging.example.com/cross-tenant-topic created
# --
#
not ok 37 tenant A cannot reference tenant B VirtualCluster in 313ms
# (in test file functional-tests/bats/04_multi_tenant.bats, line 95)
#   `assert_failure' failed
#
# -- command succeeded, but it was expected to fail --
# output : serviceaccount.messaging.example.com/cross-tenant-sa-2 created
# --
#
not ok 38 ACL cannot reference Topic from different tenant in 844ms
# (in test file functional-tests/bats/04_multi_tenant.bats, line 118)
#   `assert_failure' failed
# topic.messaging.example.com/acl-test-topic-a created
# topic.messaging.example.com/acl-test-topic-b created
#
# -- command succeeded, but it was expected to fail --
# output : acl.messaging.example.com/cross-tenant-acl created
# --
#
not ok 39 ConsumerGroup cannot be created under different tenant ServiceAccount in 325ms
# (in test file functional-tests/bats/04_multi_tenant.bats, line 135)
#   `assert_failure' failed
#
# -- command succeeded, but it was expected to fail --
# output : consumergroup.messaging.example.com/cross-tenant-cg created
# --
#
ok 40 tenants have isolated resource counts in 1222ms
# Setting up HA failover tests
# Scaling webhook to 2 replicas
ok 41 webhook has 2 ready replicas in 140ms
not ok 42 webhook service has multiple endpoints in 184ms
# (in test file functional-tests/bats/05_ha_failover.bats, line 45)
#   `[[ "$endpoint_count" -ge 2 ]]' failed
# Warning: v1 Endpoints is deprecated in v1.33+; use discovery.k8s.io/v1 EndpointSlice
# Error from server (NotFound): endpoints "messaging-operator-messaging-operator-webhook" not found
# Deleting pod: messaging-operator-webhook-788c6f5c6d-blshc
ok 43 webhook survives single pod failure in 19390ms
ok 44 webhook recovers after pod restart in 2659ms
# Starting rolling restart
not ok 45 rolling restart maintains availability in 138ms
# (in test file functional-tests/bats/05_ha_failover.bats, line 91)
#   `kubectl rollout restart deployment/"${RELEASE_NAME}-messaging-operator-webhook" -n "$NAMESPACE"' failed
# Error from server (NotFound): deployments.apps "messaging-operator-messaging-operator-webhook" not found
not ok 46 webhook handles concurrent requests during failover in 682ms
# (in test file functional-tests/bats/05_ha_failover.bats, line 129)
#   `((success_count++))' failed
# pod "messaging-operator-webhook-788c6f5c6d-c2cp5" deleted
# topic.messaging.example.com/concurrent-topic-1 created
# Found 3 HA test topics
ok 47 all created topics exist after HA tests in 5249ms
[0;31m[ERROR][0m Bats tests failed
